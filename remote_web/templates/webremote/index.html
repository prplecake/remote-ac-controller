{% load static %}
{% load webremote_extras %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>webremote</title>
    <link rel="stylesheet" href="{% static 'css/main.css' %}"/>
</head>
<body>
<div class="parent">
    <div class="child">
        <div id="latest-sensor-data"></div>
        {% for object in obj %}
            <p>{{ object.date }} :: {{ object.temp_c|convert_to_fahrenheit|floatformat:2 }} F ({{ object.temp_c }} C),
                Humidity: {{ object.humidity }}</p>
        {% endfor %}
    </div>
    <div class="child">
        <div>
            {% include "webremote/remote_control.html" %}
        </div>

        <div>
            {% include "webremote/chart.html" %}
        </div>
    </div>
</div>
<script>
    const minuteInMiliseconds = 60000;

    async function get_latest_sensor_data() {
        const response = await fetch("/api/dht/get_current");
        let data = await response.json();
        update_latest_data(data);

        setTimeout(get_latest_sensor_data, minuteInMiliseconds * 5);
    }

    function update_latest_data(data) {
        console.log(data);
        let elem = document.getElementById("latest-sensor-data");
        let htmlText;
        if (data.error != "") {
            htmlText = "<p>" + data.error + "</p>";
        } else {
            htmlText = "<p>Temp: " + convert_to_fahrenheit(data.temp_c.toFixed(1)) + " F (" + data.temp_c.toFixed(1) + " C)</p>"
                + "<p>Humidity: " + data.humidity.toFixed(2) + "%</p>";
        }
        elem.innerHTML = htmlText;
    }

    get_latest_sensor_data();
</script>
</body>
</html>
